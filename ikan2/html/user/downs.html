<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>推广中心 - {$maccms.site_name}</title>
	<meta name="keywords" content="">
	<meta name="description" content="">
	{include file="user/include" /}
</head>
<body style="background: #000;">
{include file="user/head" /}

<style>
    html,body{margin: 0;padding: 0;border:0;}
    .img-box{
        position: relative;
    }
    #qrcode{
        position:absolute;
        left:0;
        bottom:0;
        background: #ffffff;
        padding:5px;
    }
    .close-btn{
    	position: absolute;
    	right:20px;
    	top:20px;
    }
    .close-btn img{
    	width:50px;
		height: 50px;
		vertical-align: middle;
    }
</style>

<div id="member" class="fn-clear">
	<div id="left">
        <div class="m-nav">
			<a href="javascript:MAC.GoBack()" class="btn-left"><i class="iconfont ico-right">&#xe635;</i></a>
			<a href="{$maccms.path}" class="btn-right"><i class="iconfont ico-right">&#xe63a;</i></a>
			<span class="mb-title">个人中心</span>
	    </div>
        {include file="user/left_nav" /}
	</div>
    <div id="right">
    <div class="page2">
        <div class="img-box">
        	<div class="close-btn">
        		<img src="/images/close-icon.png">
        	</div>
            <img id="img_bg" style="border: 0;width: 100%;max-width: 100%;" src="" alt="">
            <div id="qrcode" style="display: none;"></div>
        </div>
    </div>
    </div>
</div>

<script>
    //生成二维码数据的数组
    var qrcodeArr=[
"http://{$GLOBALS['config']['extra']['qrurl01']}{:mac_url('user/visit')}?uid={$obj.user_id}",
"http://{$GLOBALS['config']['extra']['qrurl02']}{:mac_url('user/visit')}?uid={$obj.user_id}",
"http://{$GLOBALS['config']['extra']['qrurl03']}{:mac_url('user/visit')}?uid={$obj.user_id}",
"http://{$GLOBALS['config']['extra']['qrurl03']}{:mac_url('user/visit')}?uid={$obj.user_id}",
"http://{$GLOBALS['config']['extra']['qrurl04']}{:mac_url('user/visit')}?uid={$obj.user_id}",
"http://{$GLOBALS['config']['extra']['qrurl05']}{:mac_url('user/visit')}?uid={$obj.user_id}",
"http://{$GLOBALS['config']['extra']['qrurl06']}{:mac_url('user/visit')}?uid={$obj.user_id}",
"http://{$GLOBALS['config']['extra']['qrurl07']}{:mac_url('user/visit')}?uid={$obj.user_id}",
"http://{$GLOBALS['config']['extra']['qrurl08']}{:mac_url('user/visit')}?uid={$obj.user_id}",
"http://{$GLOBALS['config']['extra']['qrurl09']}{:mac_url('user/visit')}?uid={$obj.user_id}",
    ];
	var posterCanvas  = document.createElement("canvas");
	var ctx = posterCanvas.getContext("2d");

    $(function(){
		markPoster();
        $(window).resize(function () {
			markPoster();
        });
        $(".close-btn").click(function(){
        	window.history.back();
        });
    });


    function markPoster(){
		var cW = window.screen.width;
		var cH = window.screen.height;
		var bgImg = new Image();
		bgImg.src = "/images/bg-qr.jpg";//背景图路径
		bgImg.setAttribute("crossOrigin",'Anonymous');
		var bgW = 0;
		var bgH = 0;
		bgImg.onload = function() {
			bgW = this.width;
			bgH = this.height;
			posterCanvas.width = bgW;
			posterCanvas.height = bgH;
			ctx.drawImage(this, 0, 0,bgW, bgH);

			markQrCode();
			var qrCodeImg = $("#qrcode img");

			qrCodeImg[0].onload = function() {
				var qrW = this.width;
				var qrH = this.height;
				var sX = (bgW-qrW)/2+10;
				var sY = (bgH-qrH)/2+235;
				ctx.drawImage(this, sX, sY,qrW, qrW);
				var image = $("#img_bg").attr("src",posterCanvas.toDataURL("image/png"));
			}
		}
	}

	function markQrCode(){
		var index = Math.floor((Math.random()*qrcodeArr.length));
		var qrcode = new QRCode("qrcode",{
			text:qrcodeArr[index],
			width: 200,
			height: 200
		});
		$("#qrcode img").css("border","5px solid #ffffff");
		//qrcode.makeCode(qrcodeArr[index]);
	}
</script>
</body>
</html>